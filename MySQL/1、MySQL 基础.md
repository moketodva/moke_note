### 数据类型

##### 数值型
> MySQL版本5.1及以上,指定的是字符长度而不是字节大小

类型 | 大小（单位：字节）
---|---
tinyint | 1
smallint | 2
mediumint | 3
int | 4
bigint | 8
float | 4
double | 8
decimal(M,D) | D>M?M+2:D+2


##### 日期时间型

类型 | 大小
---|---
year | 1
time | 3
date | 3
timestamp | 4
datetime | 8

##### 字符型

类型 | 大小（单位：字节） | 说明
---|---|---
cahr | 0~2^8 | 定长； 存入的数据没达到指定长度会用空格填充
varchar | 0~2^16 | 可变长；使用1~2字节来表示长度
tinytext | 0~2^8 | 
text | 0~2^16
mediumtext | 0~2^24
longtext | 0~2^32
blob | 2^16

> MySQL单行长度不能超过2^8（不包括text和blob）

### 约束

```
根据约束的数据列个数，可以划分为
- 表级约束：对多个数据列的约束，只能在定义时声明
- 列级约束：对单个数据列的约束

根据约束的功能，可以划分：
- 主键约束：唯一性，非空
- 唯一约束：唯一性
- 非空约束：非空
- 默认约束：有默认值
- 外键约束：确保关联完整性
```

> MySQL将约束和索引结合 

### 索引

```
索引结构
- BTree：看名字容易误解，实际数据结构是B+树结构；相比hash速度慢，但适用性强
- Hash：速度是快，但范围查询、排序、分组不适用，复合索引最左匹配规则不支持，重复较高的情况下速度比BTree慢

索引类型
- 普通索引：单纯的索引
- 唯一索引：唯一约束 + 索引
- 主键索引：主键约束 + 索引
- 复合索引：多列索引，可与约束结合
- 全文索引：对文本的内容进行分词，进行搜索

至于聚簇索引，看似索引，又不像索引，它决定了不同索引与数据之间的关联。它的主键索引与记录不需要额外的映射来绑定在一起。
而非聚簇索引是需要一个映射（数据行的物理地址）来绑定到一起。在聚簇索引的情况下，除了主键索引，其它二级索引则是需要映射到主键索引。

```
> MySQL 5.1引入Index Merge 技术（索引合并），索引优化时要注意的点

> 覆盖索引：需要查的列就是被用作索引的列，如此就不必去该索引对应的物理地址取数据记录

### 连接

```
内连接
- 自然连接：列名相同的那列自动等值连接，结果中除去重复的一列（几乎没用）
- 等值连接
- 非等值连接

外连接
- 左外连接
- 右外连接
```

> 自然连接一定是等值连接，等值连接不一定是自然连接 

### 内置函数

##### 数值函数
```sql
-- 绝对值
abs(x)

-- 取模
mod(x, y)

-- 大于x的最小整数
ceil(x)

-- 小于x的最大整数
floor(x)

-- 0-1之间的随机数 
rand()

-- 参数x的y位小数的四舍五入结果
round(x, y)

-- 数字x截断为y位小数的结果
truncate(x,y)

-- 最大值
max()

-- 最小值
min()

-- 统计
count()

-- 合计
sum()

-- 平均值
avg()
```

##### 字符串函数

```sql
-- 把传入的参数连接成一个字符串
concat(s1,s2...sn)

-- 转大写
supper(str)

-- 转小写
lower(str)

-- 截取字符串
substring(str, x, y)

-- 把x替换成y
replace(str, x, y)

-- 左右两边去掉空格
trim(str)
```

##### 日期时间函数

```sql
-- 当前日期
curdate()

-- 当前时间
curtime()

-- 当前日期时间
now()

-- 日期时间类型转字符串
date_format(dt, "%Y-%m-%d %H:%i:%s")

-- 字符串转日期时间
str_to_date('2019-01-01', '%Y-%m-%d %H:%i:%s')

-- 转为timestamp
unix_timestamp(dt)

-- 从timestamp转为日期时间
from_unixtime(ts,format)

-- 返回年
year()

-- 返回月
month()

-- 返回日
day()

-- 返回时
hour()

-- 返回分
minute()

-- 返回秒
second()

-- 返回日期
date()

-- 返回时间
time()

-- 日期差
datediff()

-- 时间差
timediff()

```
### 零碎知识总结

> MySQL默认隔离级别为 Repeatable Read（简称RR）

> MySQL默认开启事物

> MySQL 8 废弃了MyISAM

> MySQL 8 默认使用了新的密码加密方式caching_sha2_password（旧的密码加密方式为mysql_native_password，引擎InnoDB）

> MySQL 8 不再使用.ibm和.frm文件存储数据索引和表表结构，都存到mysql.ibd文件中（引擎InnoDB）

> MySQL的行锁基于索引（注意主键索引与其它索引锁定顺序，不然有死锁风险），如果该条件列没有索引将会使用表锁

> MySQL 隔离级别RR及以上会有gap锁

> MySQL RR隔离级别时，使用for update有死锁风险，原因在于相同范围的gap锁与gap锁不互斥

> MySQL 隔离级别RC及以上会使用快照读（一致性读）；RC级别下，事物内每次select数据都会取新数据并且更新快照；RR级别下，事物内每次select数据只会取当前事物的快照，当前事物commit的时候就是更新快照的时候；快照读基于MVCC机制读取undo日志实现。（快照就是缓存的意思）

> MySQL 意向锁（表锁）用于让其它类型的锁更快了解到该表里用到的锁的类型，而不用等到找到相应索引才发现是相互排斥的锁

### 附录
##### 索引优化诗歌朗诵

```
    全值匹配我最爱，最左前缀要遵守；
    
    带头大哥不能死，中间兄弟不能断；
    
    索引列上少计算，范围之后全失效；
    
    Like百分写最右，覆盖索引不写星；
    
    不等空值还有or，索引失效要少用； （5.1版本引入的Index Merge技术可以让or不失效）
    
    VAR引号不可丢，SQL高级也不难！
```

> 诗句解释

```
    ①全值匹配。
    
    ②最佳左前缀法则：带头大哥不能死，中间兄弟不能断；带头大哥可跑路，老二也可跟着跑，其余兄弟只能死。
    
    ③索引列上不计算。
    
    ④覆盖索引记住用。
    
    ⑤不等于、is null、is not null导致索引失效。
    
    ⑥like百分加右边，加左边导致索引失效，解决方法：使用覆盖索引。
    
    ⑦字符串不加单引号导致索引失效。
    
    ⑧少用or，用or导致索引失效（注意：5.1版本前）
```
